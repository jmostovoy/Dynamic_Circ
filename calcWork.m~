%function W = calcWork(P,V)
% P is a list of pressure values, V is a list of volume values
% both are uniformly spaced in time with spacing dt and represent a periodic
% cycle
% return W, the work of the P-V cycle
    [argvalueV, argmaxV] = max(V);
    islessthan = 1:100;
    for j = 1:(length(V)-1)
        islessthan(j)= V(j)<= V(j+1);
    end
% engine
  i = find(diff(islessthan)) 
  n = [i numel(islessthan)] - [0 i]
  c = arrayfun(@(X) X-1:-1:0, n , 'un',0)
  y = cat(2,c{:})
  [argvalueV1, argmaxV1] = max(y);
  range1 = argmaxV1:argvalueV1+argmaxV1;
  y(range1)=0;
  [argvalueV2, argmaxV2] = max(y)
  range2 = argmaxV2:argvalueV2+argmaxV2;
  if P(range1(ceil(end/2)))>P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))<=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))<=V(range2(ceil(end/2))+1)
      W = trapz(V(range1),P(range1))-trapz(V(range2),P(range2))
  elseif P(range1(ceil(end/2)))>P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))>=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))<=V(range2(ceil(end/2))+1)
      W = -trapz(V(range1),P(range1))-trapz(V(range2),P(range2))
  elseif P(range1(ceil(end/2)))>P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))<=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))>=V(range2(ceil(end/2))+1)
      W = trapz(V(range1),P(range1))+trapz(V(range2),P(range2))
  elseif P(range1(ceil(end/2)))>P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))>=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))>=V(range2(ceil(end/2))+1)
      W = -trapz(V(range1),P(range1))+trapz(V(range2),P(range2))
  elseif P(range1(ceil(end/2)))<P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))<=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))<=V(range2(ceil(end/2))+1)
      W = trapz(V(range2),P(range2))-trapz(V(range1),P(range1))
  elseif P(range1(ceil(end/2)))<P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))>=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))<=V(range2(ceil(end/2))+1)
      W = -trapz(V(range2),P(range2))-trapz(V(range1),P(range1))
  elseif P(range1(ceil(end/2)))<P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))<=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))>=V(range2(ceil(end/2))+1)
      W = -trapz(V(range2),P(range2))-trapz(V(range1),P(range1))
 elseif P(range1(ceil(end/2)))<P(range2(ceil(end/2)))...
          && V(range1(ceil(end/2)))>=V(range1(ceil(end/2))+1)...
          && V(range2(ceil(end/2)))>=V(range2(ceil(end/2))+1)
      W = +trapz(V(range2),P(range2))+trapz(V(range1),P(range1))
  end
 
        
    
    %% hi
    
    for j = 1:length(P)
        if P(j)<=minP
            P(j)=NaN;
        end
    end
    W = P;
%end
